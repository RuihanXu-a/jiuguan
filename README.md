# 剧情优化大师 (Quick Response Force)

基于酒馆创建的小CoT思维功能插件。

## 接力思考流程（v2.2+）

你可以创建多套“流程提示词”，在每次**规划剧情**时按顺序先执行这些流程，再执行基础提示词。

- **新增流程**：在设置面板的“接力思考流程”里点“新增流程”，会复制当前基础提示词到一个新窗口供你编辑。
- **注入符号**：每个流程会自动分配一个注入符号（`$A1`、`$A2`…）。
- **输出保存**：流程每次执行的输出会写入对应注入符号，并保留到下一次同流程执行覆盖为止。
- **流程标签摘取**：每个流程都有独立的“标签摘取”，用于决定 `$A*` 保存/注入的内容；规则为“只取最后一段匹配到的标签块”，留空则保存全量输出。
- **接力注入**：把 `$A1`/`$A2` 写进基础提示词（或后续流程提示词）中，会在发送前自动替换为对应输出，从而实现“接力思考”。
- **预设导入/导出**：当你“另存为新预设 / 覆盖保存预设”时，会把当前流程配置（包含提示词与输出）一起保存；导入预设也会载入流程。

### 快速自测（手动）

1. 新增流程 -> 编辑流程提示词（确保会输出一个易识别的短句）-> 保存并关闭。
2. 在基础提示词里加入 `$A1`。
3. 发送消息触发规划：观察 toast 先显示“接力流程：$A1”，再进入正常“规划剧情…”。
4. 生成后的最终注入内容中，`$A1` 应被替换为流程输出；再次发送时若流程输出变化，`$A1` 应随之被覆盖。

## 最新功能升级 (v2.1.2)

### $5 总体大纲表自动替换功能
- 新增 `$5` 占位符，用于自动替换为"总体大纲"表内容（含表头）
- 类似数据库插件的高级功能，支持剧情推进时的总体大纲表注入

### 世界书屏蔽优化
- 在世界书读取时自动屏蔽"总体大纲"表条目，避免重复内容干扰
- 确保总体大纲表内容只通过$5占位符注入，不参与世界书递归

### $7 前文上下文注入功能
- 新增 `$7` 占位符，用于注入前文上下文和用户输入
- 将原来硬编码在systemPrompt之前的上下文注入改为可自由放置的占位符
- 支持用户在任意提示词位置自定义上下文注入位置

### 世界书增强功能
- 默认全选所有世界书条目，支持自动勾选新增世界书
- 内置屏蔽词过滤，自动过滤包含规则/思维链/变量等关键词的条目
- 数据库生成条目（TavernDB条目）不受屏蔽词限制，始终读取

### 技术实现
- `formatOutlineTableForPlot_ACU()`: 专门格式化总体大纲表内容
- 世界书过滤逻辑增强，支持屏蔽特定条目类型
